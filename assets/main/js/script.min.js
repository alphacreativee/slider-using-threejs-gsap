import{slides}from"../../libs/slides.js";import{vertexShader,fragmentShader}from"../../libs/shaders.js";import*as THREE from"https://cdn.skypack.dev/three@0.129.0/build/three.module.js";import{GLTFLoader}from"https://cdn.skypack.dev/three@0.129.0/examples/jsm/loaders/GLTFLoader.js";gsap.registerPlugin(SplitText),gsap.config({nullTargetWarn:!1});let currentSlideIndex=0,isTransitioning=!1,slideTextures=[],shaderMaterial,renderer,createCharacterElements=a=>{if(!(0<a.querySelectorAll(".char").length)){let i=a.textContent.split(" ");a.innerHTML="",i.forEach((e,r)=>{let t=document.createElement("div");t.className="word",[...e].forEach(e=>{var r=document.createElement("div");r.className="char",r.innerHTML=`<span>${e}</span>`,t.appendChild(r)}),a.appendChild(t),r<i.length-1&&((e=document.createElement("div")).className="word",e.innerHTML=`<div class="char">
        <span> </span></div>`,a.appendChild(e))})}},createLineElements=e=>{new SplitText(e,{type:"lines",linesClass:"line"}),e.querySelectorAll(".line").forEach(e=>{e.innerHTML=`<span>${e.textContent}</span>`})},processTextElements=e=>{var r=e.querySelector(".slide-title h1");r&&createCharacterElements(r),e.querySelectorAll(".slide-description p").forEach(createLineElements)},createSlideElements=e=>{var r=document.createElement("div");return r.className="slider-content",r.style.opacity="0",r.innerHTML=`
    <div class="slide-title">
      <h1>${e.title}</h1>
    </div>
    <div class="slide-description">
      <p>${e.description}</p>
      <div class="slide-info">
        <p>Type. ${e.type}</p>
        <p>Field. ${e.field}</p>
        <p>Date. ${e.date}</p>
      </div>
    </div>
  `,r},animateSlideTransition=i=>{let e=document.querySelector(".slider-content"),r=document.querySelector(".slider"),a=gsap.timeline();a.to([...e.querySelectorAll(".char span")],{y:"-100%",duration:.6,stagger:.025,ease:"power2.inOut"}).to([...e.querySelectorAll(".line span")],{y:"-100%",duration:.6,stagger:.025,ease:"power2.inOut"},.1).call(()=>{let t=createSlideElements(slides[i]);a.kill(),e.remove(),r.appendChild(t),gsap.set(t.querySelectorAll("span"),{y:"100%"}),setTimeout(()=>{processTextElements(t);var e=t.querySelectorAll(".char span"),r=t.querySelectorAll(".line span");gsap.set([e,r],{y:"100%"}),gsap.set(t,{opacity:1}),gsap.timeline({onComplete:()=>{isTransitioning=!1,currentSlideIndex=i}}).to(e,{y:"0%",duration:.6,stagger:.025,ease:"power2.inOut"}).to(r,{y:"0%",duration:.6,stagger:.025,ease:"power2.inOut"},.3)},100)},null,.5)},setupInitialSlide=()=>{var e=document.querySelector(".slider-content"),r=(processTextElements(e),e.querySelectorAll(".char span")),e=e.querySelectorAll(".line span");gsap.fromTo(r,{y:"100%"},{y:"0%",duration:.8,stagger:.025,ease:"pơwer2.out"}),gsap.fromTo(e,{y:"100%"},{y:"0%",duration:.8,stagger:.025,ease:"pơwer2.out",delay:.2})},intializeRenderer=async()=>{let e=new THREE.Scene,r=new THREE.OrthographicCamera(-1,1,1,-1,0,1),t=((renderer=new THREE.WebGLRenderer({canvas:document.querySelector("canvas"),antialias:!0})).setSize(window.innerWidth,window.innerHeight),shaderMaterial=new THREE.ShaderMaterial({uniforms:{uTexture1:{value:null},uTexture2:{value:null},uProgress:{value:0},uResolution:{value:new THREE.Vector2(window.innerWidth,window.innerHeight)},uTexture1Size:{value:new THREE.Vector2(1,1)},uTexture2Size:{value:new THREE.Vector2(1,1)}},vertexShader:vertexShader,fragmentShader:fragmentShader}),e.add(new THREE.Mesh(new THREE.PlaneGeometry(2,2),shaderMaterial)),new THREE.TextureLoader);for(let r of slides){var i=await new Promise(e=>t.load(r.image,e));console.log(slides),i.minFilter=i.magFilter=THREE.LinearFilter,i.userData={size:new THREE.Vector2(i.image.width,i.image.height)},slideTextures.push(i)}shaderMaterial.uniforms.uTexture1.value=slideTextures[0],shaderMaterial.uniforms.uTexture2.value=slideTextures[1],shaderMaterial.uniforms.uTexture1Size.value=slideTextures[0].userData.size,shaderMaterial.uniforms.uTexture2Size.value=slideTextures[1].userData.size;let a=()=>{requestAnimationFrame(a),renderer.render(e,r)};a()},handleSlideChange=()=>{if(!isTransitioning){isTransitioning=!0;let e=(currentSlideIndex+1)%slides.length;shaderMaterial.uniforms.uTexture1.value=slideTextures[currentSlideIndex],shaderMaterial.uniforms.uTexture2.value=slideTextures[e],shaderMaterial.uniforms.uTexture1Size.value=slideTextures[currentSlideIndex].userData.size,shaderMaterial.uniforms.uTexture2Size.value=slideTextures[e].userData.size,animateSlideTransition(e),gsap.fromTo(shaderMaterial.uniforms.uProgress,{value:0},{value:1,duration:2.5,ease:"power2.inOut",onComplete:()=>{shaderMaterial.uniforms.uProgress.value=0,shaderMaterial.uniforms.uTexture1.value=slideTextures[e],shaderMaterial.uniforms.uTexture1Size.value=slideTextures[e].userData.size}})}},handleResize=()=>{renderer.setSize(window.innerWidth,window.innerHeight),shaderMaterial.uniforms.uResolution.value.set(window.innerWidth,window.innerHeight)};window.addEventListener("load",()=>{setupInitialSlide(),intializeRenderer()}),document.addEventListener("click",handleSlideChange),window.addEventListener("resize",handleResize);